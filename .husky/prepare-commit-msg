#!/bin/sh

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

if [ "$COMMIT_SOURCE" = "merge" ] || [ "$COMMIT_SOURCE" = "squash" ] || [ "$COMMIT_SOURCE" = "commit" ]; then
  exit 0
fi

BRANCH_NAME=$(git symbolic-ref --short HEAD 2>/dev/null)

ISSUE_NUMBER=$(echo "$BRANCH_NAME" | grep -oE '#[0-9]+' | head -1)

if [ -z "$ISSUE_NUMBER" ]; then
  exit 0
fi

COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

if echo "$COMMIT_MSG" | grep -qE '\(#[0-9]+\)'; then
  exit 0
fi

echo "$COMMIT_MSG ($ISSUE_NUMBER)" > "$COMMIT_MSG_FILE"
